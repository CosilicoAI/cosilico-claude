---
description: "File an upstream bug report when validation reveals discrepancies"
argument-hint: "<description of bug>"
---

# File Upstream Bug Command

File a bug report to an upstream repository (PolicyEngine, TAXSIM, etc.) when validation reveals a discrepancy and you're confident in the encoding.

## Arguments
- `$ARGUMENTS` - Validation results file or description of the bug

## Workflow

### 1. Gather evidence
Ensure you have:
- Test case with clear inputs
- Expected value (from statute)
- Actual value (from validator)
- Statute citation
- Your confidence level (should be >90%)

### 2. Check for duplicates
```bash
# Search PolicyEngine issues
gh search issues --repo PolicyEngine/policyengine-us "EITC" --state open

# Or use the API
gh api repos/PolicyEngine/policyengine-us/issues --jq '.[] | select(.title | contains("EITC"))'
```

### 3. Create the issue

**For PolicyEngine:**
```bash
gh issue create --repo PolicyEngine/policyengine-us \
  --title "[cosilico-validators] Potential calculation error: EITC for single filer" \
  --body "$(cat <<'EOF'
## Bug Report (Auto-generated by cosilico-validators)

### Summary
Validation against authoritative sources detected a potential calculation discrepancy.

### Test Case
**Name:** EITC single filer, 1 child, $25,000 income
**Year:** 2024

### Inputs
```json
{
  "earned_income": 25000,
  "filing_status": "SINGLE",
  "eitc_qualifying_children_count": 1
}
```

### Expected vs Actual
| Source | Value |
|--------|-------|
| **Expected (from statute)** | $3,995 |
| **PolicyEngine calculated** | $4,100 |
| **Difference** | $105 |

### Citation
26 USC ยง 32(b)(1)(A) - Phase-in rate of 34%

### Confidence
Claude encoding confidence: 95%

### Reproduction
```python
from policyengine_us import Simulation

situation = {
    "people": {"adult": {"employment_income": {"2024": 25000}}},
    "tax_units": {"tax_unit": {"members": ["adult"]}},
    # ... full situation
}
sim = Simulation(situation=situation)
print(sim.calculate("eitc", 2024))
```

---
*This issue was automatically generated by cosilico-validators. Please verify before addressing.*
EOF
)"
```

### 4. Track the issue
Add to local tracking:
```bash
# Record in beads
bd create --title="PE issue: EITC calculation" --type=bug --body="Filed: gh issue #XXX"
```

## Issue Templates

### PolicyEngine
- Repo: `PolicyEngine/policyengine-us`
- Labels: `bug`, `eitc` (or relevant program)
- Include: Situation JSON, expected value, citation

### TAXSIM
- TAXSIM doesn't have a public issue tracker
- Document in local notes
- Consider contacting NBER directly for significant issues

### PSL Tax-Calculator
- Repo: `PSLmodels/Tax-Calculator`
- Include: Tax reform JSON, expected vs actual

## Example Usage

```
/file-bug EITC phase-out calculation differs by $105 for single filer with 1 child at $25k income
```
